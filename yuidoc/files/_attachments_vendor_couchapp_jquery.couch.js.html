<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>_attachments&#x2F;vendor&#x2F;couchapp&#x2F;jquery.couch.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/$user
Couchdb user service.html">$user
Couchdb user service</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: _attachments&#x2F;vendor&#x2F;couchapp&#x2F;jquery.couch.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;&#x2F; Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
&#x2F;&#x2F; use this file except in compliance with the License. You may obtain a copy of
&#x2F;&#x2F; the License at
&#x2F;&#x2F;
&#x2F;&#x2F;   http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0
&#x2F;&#x2F;
&#x2F;&#x2F; Unless required by applicable law or agreed to in writing, software
&#x2F;&#x2F; distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
&#x2F;&#x2F; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
&#x2F;&#x2F; License for the specific language governing permissions and limitations under
&#x2F;&#x2F; the License.

&#x2F;**
 * @namespace
 * $.couch is used to communicate with a CouchDB server, the server methods can
 * be called directly without creating an instance. Typically all methods are
 * passed an &lt;code&gt;options&lt;&#x2F;code&gt; object which defines a success callback which
 * is called with the data returned from the http request to CouchDB, you can
 * find the other settings that can be used in the &lt;code&gt;options&lt;&#x2F;code&gt; object
 * from &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
 * jQuery.ajax settings&lt;&#x2F;a&gt;
 * &lt;pre&gt;&lt;code&gt;$.couch.activeTasks({
 *   success: function (data) {
 *     console.log(data);
 *   }
 * });&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
 * Outputs (for example):
 * &lt;pre&gt;&lt;code&gt;[
 *  {
 *   &quot;pid&quot; : &quot;&lt;0.11599.0&gt;&quot;,
 *   &quot;status&quot; : &quot;Copied 0 of 18369 changes (0%)&quot;,
 *   &quot;task&quot; : &quot;recipes&quot;,
 *   &quot;type&quot; : &quot;Database Compaction&quot;
 *  }
 *]&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
 *&#x2F;
(function($) {

  $.couch = $.couch || {};
  &#x2F;** @lends $.couch *&#x2F;

  &#x2F;**
   * @private
   *&#x2F;
  function encodeDocId(docID) {
    var parts = docID.split(&quot;&#x2F;&quot;);
    if (parts[0] == &quot;_design&quot;) {
      parts.shift();
      return &quot;_design&#x2F;&quot; + encodeURIComponent(parts.join(&#x27;&#x2F;&#x27;));
    }
    return encodeURIComponent(docID);
  }

  &#x2F;**
   * @private
   *&#x2F;

  var uuidCache = [];

  $.extend($.couch, {
    urlPrefix: &#x27;&#x27;,

    &#x2F;**
     * You can obtain a list of active tasks by using the &#x2F;_active_tasks URL.
     * The result is a JSON array of the currently running tasks, with each task
     * being described with a single object.
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;uploads&#x2F;
     * all&#x2F;documentation&#x2F;couchbase-api-misc.html#couchbase-api-misc_active-task
     * s_get&quot;&gt;docs for &#x2F;_active_tasks&lt;&#x2F;a&gt;
     * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax
     * &#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    activeTasks: function(options) {
      ajax(
        {url: this.urlPrefix + &quot;&#x2F;_active_tasks&quot;},
        options,
        &quot;Active task status could not be retrieved&quot;
      );
    },

    &#x2F;**
     * Returns a list of all the databases in the CouchDB instance
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;uploads&#x2F;
     * all&#x2F;documentation&#x2F;couchbase-api-misc.html#couchbase-api-misc_active-task
     * s_get&quot;&gt;docs for &#x2F;_all_dbs&lt;&#x2F;a&gt;
     * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax
     * &#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    allDbs: function(options) {
      ajax(
        {url: this.urlPrefix + &quot;&#x2F;_all_dbs&quot;},
        options,
        &quot;An error occurred retrieving the list of all databases&quot;
      );
    },

    &#x2F;**
     * View and edit the CouchDB configuration, called with just the options
     * parameter the entire config is returned, you can be more specific by
     * passing the section and option parameters, if you specify a value that
     * value will be stored in the configuration.
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;uploads&#x2F;
     * all&#x2F;documentation&#x2F;couchbase-api-config.html#couchbase-api-config_config
     * -section-key_put&quot;&gt;docs for &#x2F;_config&lt;&#x2F;a&gt;
     * @param {ajaxSettings} options
     * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
     * jQuery ajax settings&lt;&#x2F;a&gt;
     * @param {String} [section] the section of the config
     * @param {String} [option] the particular config option
     * @param {String} [value] value to be set
     *&#x2F;
    config: function(options, section, option, value) {
      var req = {url: this.urlPrefix + &quot;&#x2F;_config&#x2F;&quot;};
      if (section) {
        req.url += encodeURIComponent(section) + &quot;&#x2F;&quot;;
        if (option) {
          req.url += encodeURIComponent(option);
        }
      }
      if (value === null) {
        req.type = &quot;DELETE&quot;;        
      } else if (value !== undefined) {
        req.type = &quot;PUT&quot;;
        req.data = toJSON(value);
        req.contentType = &quot;application&#x2F;json&quot;;
        req.processData = false
      }

      ajax(req, options,
        &quot;An error occurred retrieving&#x2F;updating the server configuration&quot;
      );
    },
    
    &#x2F;**
     * Returns the session information for the currently logged in user.
     * @param {ajaxSettings} options
     * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
     * jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    session: function(options) {
      options = options || {};
      $.ajax({
        type: &quot;GET&quot;, url: this.urlPrefix + &quot;&#x2F;_session&quot;,
        beforeSend: function(xhr) {
            xhr.setRequestHeader(&#x27;Accept&#x27;, &#x27;application&#x2F;json&#x27;);
        },
        complete: function(req) {
          var resp = $.parseJSON(req.responseText);
          if (req.status == 200) {
            if (options.success) options.success(resp);
          } else if (options.error) {
            options.error(req.status, resp.error, resp.reason);
          } else {
            throw &quot;An error occurred getting session info: &quot; + resp.reason;
          }
        }
      });
    },

    &#x2F;**
     * @private
     *&#x2F;
    userDb : function(callback) {
      $.couch.session({
        success : function(resp) {
          var userDb = $.couch.db(resp.info.authentication_db);
          callback(userDb);
        }
      });
    },

    &#x2F;**
     * Create a new user on the CouchDB server, &lt;code&gt;user_doc&lt;&#x2F;code&gt; is an
     * object with a &lt;code&gt;name&lt;&#x2F;code&gt; field and other information you want
     * to store relating to that user, for example
     * &lt;code&gt;{&quot;name&quot;: &quot;daleharvey&quot;}&lt;&#x2F;code&gt;
     * @param {Object} user_doc Users details
     * @param {String} password Users password
     * @param {ajaxSettings} options
     * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
      * jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    signup: function(user_doc, password, options) {      
      options = options || {};
      user_doc.password = password;
      user_doc.roles =  user_doc.roles || [];
      user_doc.type =  user_doc.type = &quot;user&quot; || [];
      var user_prefix = &quot;org.couchdb.user:&quot;;
      user_doc._id = user_doc._id || user_prefix + user_doc.name;

      $.couch.userDb(function(db) {
        db.saveDoc(user_doc, options);
      });
    },

    &#x2F;**
     * Authenticate against CouchDB, the &lt;code&gt;options&lt;&#x2F;code&gt; parameter is
      *expected to have &lt;code&gt;name&lt;&#x2F;code&gt; and &lt;code&gt;password&lt;&#x2F;code&gt; fields.
     * @param {ajaxSettings} options
     * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
     * jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    login: function(options) {
      options = options || {};
      $.ajax({
        type: &quot;POST&quot;, url: this.urlPrefix + &quot;&#x2F;_session&quot;, dataType: &quot;json&quot;,
        data: {name: options.name, password: options.password},
        beforeSend: function(xhr) {
            xhr.setRequestHeader(&#x27;Accept&#x27;, &#x27;application&#x2F;json&#x27;);
        },
        complete: function(req) {
          var resp = $.parseJSON(req.responseText);
          if (req.status == 200) {
            if (options.success) options.success(resp);
          } else if (options.error) {
            options.error(req.status, resp.error, resp.reason);
          } else {
            throw &#x27;An error occurred logging in: &#x27; + resp.reason;
          }
        }
      });
    },


    &#x2F;**
     * Delete your current CouchDB user session
     * @param {ajaxSettings} options
     * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
     * jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    logout: function(options) {
      options = options || {};
      $.ajax({
        type: &quot;DELETE&quot;, url: this.urlPrefix + &quot;&#x2F;_session&quot;, dataType: &quot;json&quot;,
        username : &quot;_&quot;, password : &quot;_&quot;,
        beforeSend: function(xhr) {
            xhr.setRequestHeader(&#x27;Accept&#x27;, &#x27;application&#x2F;json&#x27;);
        },
        complete: function(req) {
          var resp = $.parseJSON(req.responseText);
          if (req.status == 200) {
            if (options.success) options.success(resp);
          } else if (options.error) {
            options.error(req.status, resp.error, resp.reason);
          } else {
            throw &#x27;An error occurred logging out: &#x27; + resp.reason;
          }
        }
      });
    },

    &#x2F;**
     * @namespace
     * $.couch.db is used to communicate with a specific CouchDB database
     * &lt;pre&gt;&lt;code&gt;var $db = $.couch.db(&quot;mydatabase&quot;);
     *$db.allApps({
     *  success: function (data) {
     *    ... process data ...
     *  }
     *});
     * &lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
     *&#x2F;
    db: function(name, db_opts) {
      db_opts = db_opts || {};
      var rawDocs = {};
      function maybeApplyVersion(doc) {
        if (doc._id &amp;&amp; doc._rev &amp;&amp; rawDocs[doc._id] &amp;&amp;
            rawDocs[doc._id].rev == doc._rev) {
          &#x2F;&#x2F; todo: can we use commonjs require here?
          if (typeof Base64 == &quot;undefined&quot;) {
            throw &#x27;Base64 support not found.&#x27;;
          } else {
            doc._attachments = doc._attachments || {};
            doc._attachments[&quot;rev-&quot;+doc._rev.split(&quot;-&quot;)[0]] = {
              content_type :&quot;application&#x2F;json&quot;,
              data : Base64.encode(rawDocs[doc._id].raw)
            };
            return true;
          }
        }
      };
      return &#x2F;** @lends $.couch.db *&#x2F;{
        name: name,
        uri: this.urlPrefix + &quot;&#x2F;&quot; + encodeURIComponent(name) + &quot;&#x2F;&quot;,

        &#x2F;**
         * Request compaction of the specified database.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db-compact_post&quot;&gt;docs for &#x2F;db&#x2F;_compact&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options
         * &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;
         * jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        compact: function(options) {
          $.extend(options, {successStatus: 202});
          ajax({
              type: &quot;POST&quot;, url: this.uri + &quot;_compact&quot;,
              data: &quot;&quot;, processData: false
            },
            options,
            &quot;The database could not be compacted&quot;
          );
        },

        &#x2F;**
         * Cleans up the cached view output on disk for a given view.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db
         * _db-view-cleanup_post&quot;&gt;docs for &#x2F;db&#x2F;_compact&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        viewCleanup: function(options) {
          $.extend(options, {successStatus: 202});
          ajax({
              type: &quot;POST&quot;, url: this.uri + &quot;_view_cleanup&quot;,
              data: &quot;&quot;, processData: false
            },
            options,
            &quot;The views could not be cleaned up&quot;
          );
        },

        &#x2F;**
         * Compacts the view indexes associated with the specified design
         * document. You can use this in place of the full database compaction
         * if you know a specific set of view indexes have been affected by a
         * recent database change.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;upl
         * oads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_db-
         * compact-design-doc_post&quot;&gt;docs for &#x2F;db&#x2F;_compact&#x2F;design-doc&lt;&#x2F;a&gt;
         * @param {String} groupname Name of design-doc to compact
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        compactView: function(groupname, options) {
          $.extend(options, {successStatus: 202});
          ajax({
              type: &quot;POST&quot;, url: this.uri + &quot;_compact&#x2F;&quot; + groupname,
              data: &quot;&quot;, processData: false
            },
            options,
            &quot;The view could not be compacted&quot;
          );
        },

        &#x2F;**
         * Create a new database
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db_put&quot;&gt;docs for PUT &#x2F;db&#x2F;&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        create: function(options) {
          $.extend(options, {successStatus: 201});
          ajax({
              type: &quot;PUT&quot;, url: this.uri, contentType: &quot;application&#x2F;json&quot;,
              data: &quot;&quot;, processData: false
            },
            options,
            &quot;The database could not be created&quot;
          );
        },

        &#x2F;**
         * Deletes the specified database, and all the documents and
         * attachments contained within it.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db_delete&quot;&gt;docs for DELETE &#x2F;db&#x2F;&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        drop: function(options) {
          ajax(
            {type: &quot;DELETE&quot;, url: this.uri},
            options,
            &quot;The database could not be deleted&quot;
          );
        },

        &#x2F;**
         * Gets information about the specified database.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db
         * _db_get&quot;&gt;docs for GET &#x2F;db&#x2F;&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        info: function(options) {
          ajax(
            {url: this.uri},
            options,
            &quot;Database information could not be retrieved&quot;
          );
        },

        &#x2F;**
         * @namespace
         * $.couch.db.changes provides an API for subscribing to the changes
         * feed
         * &lt;pre&gt;&lt;code&gt;var $changes = $.couch.db(&quot;mydatabase&quot;).changes();
         *$changes.onChange = function (data) {
         *    ... process data ...
         * }
         * $changes.stop();
         * &lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
         *&#x2F;
        changes: function(since, options) {

          options = options || {};
          &#x2F;&#x2F; set up the promise object within a closure for this handler
          var timeout = 100, db = this, active = true,
            listeners = [],
            promise = &#x2F;** @lends $.couch.db.changes *&#x2F; {
              &#x2F;**
               * Add a listener callback
               * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;
               * files&#x2F;uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couch
               * base-api-db_db-changes_get&quot;&gt;docs for &#x2F;db&#x2F;_changes&lt;&#x2F;a&gt;
               * @param {Function} fun Callback function to run when
               * notified of changes.
               *&#x2F;
            onChange : function(fun) {
              listeners.push(fun);
            },
              &#x2F;**
               * Stop subscribing to the changes feed
               *&#x2F;
            stop : function() {
              active = false;
            }
          };
          &#x2F;&#x2F; call each listener when there is a change
          function triggerListeners(resp) {
            $.each(listeners, function() {
              this(resp);
            });
          };
          &#x2F;&#x2F; when there is a change, call any listeners, then check for
          &#x2F;&#x2F; another change
          options.success = function(resp) {
            timeout = 100;
            if (active) {
              since = resp.last_seq;
              triggerListeners(resp);
              getChangesSince();
            };
          };
          options.error = function() {
            if (active) {
              setTimeout(getChangesSince, timeout);
              timeout = timeout * 2;
            }
          };
          &#x2F;&#x2F; actually make the changes request
          function getChangesSince() {
            var opts = $.extend({heartbeat : 10 * 1000}, options, {
              feed : &quot;longpoll&quot;,
              since : since
            });
            ajax(
              {url: db.uri + &quot;_changes&quot;+encodeOptions(opts)},
              options,
              &quot;Error connecting to &quot;+db.uri+&quot;&#x2F;_changes.&quot;
            );
          }
          &#x2F;&#x2F; start the first request
          if (since) {
            getChangesSince();
          } else {
            db.info({
              success : function(info) {
                since = info.update_seq;
                getChangesSince();
              }
            });
          }
          return promise;
        },

        &#x2F;**
         * Fetch all the docs in this db, you can specify an array of keys to
         * fetch by passing the &lt;code&gt;keys&lt;&#x2F;code&gt; field in the
         * &lt;code&gt;options&lt;&#x2F;code&gt;
         * parameter.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db-all-docs_get&quot;&gt;docs for &#x2F;db&#x2F;all_docs&#x2F;&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        allDocs: function(options) {
          var type = &quot;GET&quot;;
          var data = null;
          if (options[&quot;keys&quot;]) {
            type = &quot;POST&quot;;
            var keys = options[&quot;keys&quot;];
            delete options[&quot;keys&quot;];
            data = toJSON({ &quot;keys&quot;: keys });
          }
          ajax({
              type: type,
              data: data,
              url: this.uri + &quot;_all_docs&quot; + encodeOptions(options)
            },
            options,
            &quot;An error occurred retrieving a list of all documents&quot;
          );
        },

        &#x2F;**
         * Fetch all the design docs in this db
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        allDesignDocs: function(options) {
          this.allDocs($.extend(
            {startkey:&quot;_design&quot;, endkey:&quot;_design0&quot;}, options));
        },

        &#x2F;**
         * Fetch all the design docs with an index.html, &lt;code&gt;options&lt;&#x2F;code&gt;
         * parameter expects an &lt;code&gt;eachApp&lt;&#x2F;code&gt; field which is a callback
         * called on each app found.
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        allApps: function(options) {
          options = options || {};
          var self = this;
          if (options.eachApp) {
            this.allDesignDocs({
              success: function(resp) {
                $.each(resp.rows, function() {
                  self.openDoc(this.id, {
                    success: function(ddoc) {
                      var index, appPath, appName = ddoc._id.split(&#x27;&#x2F;&#x27;);
                      appName.shift();
                      appName = appName.join(&#x27;&#x2F;&#x27;);
                      index = ddoc.couchapp &amp;&amp; ddoc.couchapp.index;
                      if (index) {
                        appPath = [&#x27;&#x27;, name, ddoc._id, index].join(&#x27;&#x2F;&#x27;);
                      } else if (ddoc._attachments &amp;&amp;
                                 ddoc._attachments[&quot;index.html&quot;]) {
                        appPath = [&#x27;&#x27;, name, ddoc._id, &quot;index.html&quot;].join(&#x27;&#x2F;&#x27;);
                      }
                      if (appPath) options.eachApp(appName, appPath, ddoc);
                    }
                  });
                });
              }
            });
          } else {
            throw &#x27;Please provide an eachApp function for allApps()&#x27;;
          }
        },

        &#x2F;**
         * Returns the specified doc from the specified db.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-dbdoc.html#couchbase-api-
         * dbdoc_db-doc_get&quot;&gt;docs for GET &#x2F;db&#x2F;doc&lt;&#x2F;a&gt;
         * @param {String} docId id of document to fetch
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         * @param {ajaxSettings} ajaxOptions &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        openDoc: function(docId, options, ajaxOptions) {
          options = options || {};
          if (db_opts.attachPrevRev || options.attachPrevRev) {
            $.extend(options, {
              beforeSuccess : function(req, doc) {
                rawDocs[doc._id] = {
                  rev : doc._rev,
                  raw : req.responseText
                };
              }
            });
          } else {
            $.extend(options, {
              beforeSuccess : function(req, doc) {
                if (doc[&quot;jquery.couch.attachPrevRev&quot;]) {
                  rawDocs[doc._id] = {
                    rev : doc._rev,
                    raw : req.responseText
                  };
                }
              }
            });
          }
          ajax({url: this.uri + encodeDocId(docId) + encodeOptions(options)},
            options,
            &quot;The document could not be retrieved&quot;,
            ajaxOptions
          );
        },

        &#x2F;**
         * Create a new document in the specified database, using the supplied
         * JSON document structure. If the JSON structure includes the _id
         * field, then the document will be created with the specified document
         * ID. If the _id field is not specified, a new unique ID will be
         * generated.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-dbdoc.html#couchbase-api-
         * dbdoc_db_post&quot;&gt;docs for GET &#x2F;db&#x2F;doc&lt;&#x2F;a&gt;
         * @param {String} doc document to save
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        saveDoc: function(doc, options) {
          options = options || {};
          var db = this;
          var beforeSend = fullCommit(options);
          if (doc._id === undefined) {
            var method = &quot;POST&quot;;
            var uri = this.uri;
          } else {
            var method = &quot;PUT&quot;;
            var uri = this.uri + encodeDocId(doc._id);
          }
          var versioned = maybeApplyVersion(doc);
          $.ajax({
            type: method, url: uri + encodeOptions(options),
            contentType: &quot;application&#x2F;json&quot;,
            dataType: &quot;json&quot;, data: toJSON(doc),
            beforeSend : beforeSend,
            complete: function(req) {
              var resp = $.parseJSON(req.responseText);
              if (req.status == 200 || req.status == 201 || req.status == 202) {
                doc._id = resp.id;
                doc._rev = resp.rev;
                if (versioned) {
                  db.openDoc(doc._id, {
                    attachPrevRev : true,
                    success : function(d) {
                      doc._attachments = d._attachments;
                      if (options.success) options.success(resp);
                    }
                  });
                } else {
                  if (options.success) options.success(resp);
                }
              } else if (options.error) {
                options.error(req.status, resp.error, resp.reason);
              } else {
                throw &quot;The document could not be saved: &quot; + resp.reason;
              }
            }
          });
        },

        &#x2F;**
         * Save a list of documents
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db-bulk-docs_post&quot;&gt;docs for &#x2F;db&#x2F;_bulk_docs&lt;&#x2F;a&gt;
         * @param {Object[]} docs List of documents to save
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        bulkSave: function(docs, options) {
          var beforeSend = fullCommit(options);
          $.extend(options, {successStatus: 201, beforeSend : beforeSend});
          ajax({
              type: &quot;POST&quot;,
              url: this.uri + &quot;_bulk_docs&quot; + encodeOptions(options),
              contentType: &quot;application&#x2F;json&quot;, data: toJSON(docs)
            },
            options,
            &quot;The documents could not be saved&quot;
          );
        },

        &#x2F;**
         * Deletes the specified document from the database. You must supply
         * the current (latest) revision and &lt;code&gt;id&lt;&#x2F;code&gt; of the document
         * to delete eg &lt;code&gt;removeDoc({_id:&quot;mydoc&quot;, _rev: &quot;1-2345&quot;})&lt;&#x2F;code&gt;
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-dbdoc.html#couchbase-api
         * -dbdoc_db-doc_delete&quot;&gt;docs for DELETE &#x2F;db&#x2F;doc&lt;&#x2F;a&gt;
         * @param {Object} doc Document to delete
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        removeDoc: function(doc, options) {
          ajax({
              type: &quot;DELETE&quot;,
              url: this.uri +
                   encodeDocId(doc._id) +
                   encodeOptions({rev: doc._rev})
            },
            options,
            &quot;The document could not be deleted&quot;
          );
        },

        &#x2F;**
         * Remove a set of documents
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db_
         * db-bulk-docs_post&quot;&gt;docs for &#x2F;db&#x2F;_bulk_docs&lt;&#x2F;a&gt;
         * @param {String[]} docs List of document id&#x27;s to remove
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        bulkRemove: function(docs, options){
          docs.docs = $.each(
            docs.docs, function(i, doc){
              doc._deleted = true;
            }
          );
          $.extend(options, {successStatus: 201});
          ajax({
              type: &quot;POST&quot;,
              url: this.uri + &quot;_bulk_docs&quot; + encodeOptions(options),
              data: toJSON(docs)
            },
            options,
            &quot;The documents could not be deleted&quot;
          );
        },

        &#x2F;**
         * The COPY command (which is non-standard HTTP) copies an existing
         * document to a new or existing document.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-dbdoc.html#couchbase-api-
         * dbdoc_db-doc_copy&quot;&gt;docs for COPY &#x2F;db&#x2F;doc&lt;&#x2F;a&gt;
         * @param {String[]} docId document id to copy
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        copyDoc: function(docId, options, ajaxOptions) {
          ajaxOptions = $.extend(ajaxOptions, {
            complete: function(req) {
              var resp = $.parseJSON(req.responseText);
              if (req.status == 201) {
                if (options.success) options.success(resp);
              } else if (options.error) {
                options.error(req.status, resp.error, resp.reason);
              } else {
                throw &quot;The document could not be copied: &quot; + resp.reason;
              }
            }
          });
          ajax({
              type: &quot;COPY&quot;,
              url: this.uri + encodeDocId(docId)
            },
            options,
            &quot;The document could not be copied&quot;,
            ajaxOptions
          );
        },

        &#x2F;**
         * Creates (and executes) a temporary view based on the view function
         * supplied in the JSON request.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-db.html#couchbase-api-db
         * _db-temp-view_post&quot;&gt;docs for &#x2F;db&#x2F;_temp_view&lt;&#x2F;a&gt;
         * @param {Function} mapFun Map function
         * @param {Function} reduceFun Reduce function
         * @param {Function} language Language the map &#x2F; reduce funs are
         * implemented in
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        query: function(mapFun, reduceFun, language, options) {
          language = language || &quot;javascript&quot;;
          if (typeof(mapFun) !== &quot;string&quot;) {
            mapFun = mapFun.toSource ? mapFun.toSource()
              : &quot;(&quot; + mapFun.toString() + &quot;)&quot;;
          }
          var body = {language: language, map: mapFun};
          if (reduceFun != null) {
            if (typeof(reduceFun) !== &quot;string&quot;)
              reduceFun = reduceFun.toSource ? reduceFun.toSource()
                : &quot;(&quot; + reduceFun.toString() + &quot;)&quot;;
            body.reduce = reduceFun;
          }
          ajax({
              type: &quot;POST&quot;,
              url: this.uri + &quot;_temp_view&quot; + encodeOptions(options),
              contentType: &quot;application&#x2F;json&quot;, data: toJSON(body)
            },
            options,
            &quot;An error occurred querying the database&quot;
          );
        },

        &#x2F;**
         * Fetch a _list view output, you can specify a list of
         * &lt;code&gt;keys&lt;&#x2F;code&gt; in the options object to recieve only those keys.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-design.html#couchbase-api
         * -design_db-design-designdoc-list-listname-viewname_get&quot;&gt;
         * docs for &#x2F;db&#x2F;_design&#x2F;design-doc&#x2F;_list&#x2F;l1&#x2F;v1&lt;&#x2F;a&gt;
         * @param {String} list Listname in the form of ddoc&#x2F;listname
         * @param {String} view View to run list against
         * @param {options} CouchDB &lt;a href=&quot;http:&#x2F;&#x2F;wiki.apache.org&#x2F;couchdb&#x2F;
         * HTTP_view_API&quot;&gt;View Options&lt;&#x2F;a&gt;
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        list: function(list, view, options, ajaxOptions) {
          var list = list.split(&#x27;&#x2F;&#x27;);
          var options = options || {};
          var type = &#x27;GET&#x27;;
          var data = null;
          if (options[&#x27;keys&#x27;]) {
            type = &#x27;POST&#x27;;
            var keys = options[&#x27;keys&#x27;];
            delete options[&#x27;keys&#x27;];
            data = toJSON({&#x27;keys&#x27;: keys });
          }
          ajax({
              type: type,
              data: data,
              url: this.uri + &#x27;_design&#x2F;&#x27; + list[0] +
                   &#x27;&#x2F;_list&#x2F;&#x27; + list[1] + &#x27;&#x2F;&#x27; + view + encodeOptions(options)
              },
              ajaxOptions, &#x27;An error occured accessing the list&#x27;
          );
        },

        &#x2F;**
         * Executes the specified view-name from the specified design-doc
         * design document, you can specify a list of &lt;code&gt;keys&lt;&#x2F;code&gt;
         * in the options object to recieve only those keys.
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-design.html#couchbase-api-
         * design_db-design-designdoc-view-viewname_get&quot;&gt;docs for &#x2F;db&#x2F;
         * _design&#x2F;design-doc&#x2F;_list&#x2F;l1&#x2F;v1&lt;&#x2F;a&gt;
         * @param {String} name View to run list against
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        view: function(name, options) {
          var name = name.split(&#x27;&#x2F;&#x27;);
          var options = options || {};
          var type = &quot;GET&quot;;
          var data= null;
          if (options[&quot;keys&quot;]) {
            type = &quot;POST&quot;;
            var keys = options[&quot;keys&quot;];
            delete options[&quot;keys&quot;];
            data = toJSON({ &quot;keys&quot;: keys });
          }
          ajax({
              type: type,
              data: data,
              url: this.uri + &quot;_design&#x2F;&quot; + name[0] +
                   &quot;&#x2F;_view&#x2F;&quot; + name[1] + encodeOptions(options)
            },
            options, &quot;An error occurred accessing the view&quot;
          );
        },

        &#x2F;**
         * Fetch an arbitrary CouchDB database property
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api.html&quot;&gt;docs for &#x2F;db&#x2F;_prop&lt;&#x2F;a&gt;
         * @param {String} propName Propery name to fetch
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         * @param {ajaxSettings} ajaxOptions &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        getDbProperty: function(propName, options, ajaxOptions) {
          ajax({url: this.uri + propName + encodeOptions(options)},
            options,
            &quot;The property could not be retrieved&quot;,
            ajaxOptions
          );
        },

        &#x2F;**
         * Set an arbitrary CouchDB database property
         * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
         * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api.html&quot;&gt;docs for &#x2F;db&#x2F;_prop&lt;&#x2F;a&gt;
         * @param {String} propName Propery name to fetch
         * @param {String} propValue Propery value to set
         * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         * @param {ajaxSettings} ajaxOptions &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
         * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
         *&#x2F;
        setDbProperty: function(propName, propValue, options, ajaxOptions) {
          ajax({
            type: &quot;PUT&quot;, 
            url: this.uri + propName + encodeOptions(options),
            data : JSON.stringify(propValue)
          },
            options,
            &quot;The property could not be updated&quot;,
            ajaxOptions
          );
        }
      };
    },

    encodeDocId: encodeDocId, 

    &#x2F;**
     * Accessing the root of a CouchDB instance returns meta information about
     * the instance. The response is a JSON structure containing information
     * about the server, including a welcome message and the version of the
     * server.
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;uploads&#x2F;
     * all&#x2F;documentation&#x2F;couchbase-api-misc.html#couchbase-api-misc_root_get&quot;&gt;
     * docs for GET &#x2F;&lt;&#x2F;a&gt;
     * @param {ajaxSettings} options &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
     * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
     *&#x2F;
    info: function(options) {
      ajax(
        {url: this.urlPrefix + &quot;&#x2F;&quot;},
        options,
        &quot;Server information could not be retrieved&quot;
      );
    },

    &#x2F;**
     * Request, configure, or stop, a replication operation.
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
     * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-misc.html#couchbase-api-
     * misc_replicate_post&quot;&gt;docs for POST &#x2F;_replicate&lt;&#x2F;a&gt;
     * @param {String} source Path or url to source database
     * @param {String} target Path or url to target database
     * @param {ajaxSettings} ajaxOptions &lt;a href=&quot;http:&#x2F;&#x2F;api.jquery.com&#x2F;
     * jQuery.ajax&#x2F;#jQuery-ajax-settings&quot;&gt;jQuery ajax settings&lt;&#x2F;a&gt;
     * @param {Object} repOpts Additional replication options
     *&#x2F;
    replicate: function(source, target, ajaxOptions, repOpts) {
      repOpts = $.extend({source: source, target: target}, repOpts);
      if (repOpts.continuous &amp;&amp; !repOpts.cancel) {
        ajaxOptions.successStatus = 202;
      }
      ajax({
          type: &quot;POST&quot;, url: this.urlPrefix + &quot;&#x2F;_replicate&quot;,
          data: JSON.stringify(repOpts),
          contentType: &quot;application&#x2F;json&quot;
        },
        ajaxOptions,
        &quot;Replication failed&quot;
      );
    },

    &#x2F;**
     * Fetch a new UUID
     * @see &lt;a href=&quot;http:&#x2F;&#x2F;techzone.couchbase.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;
     * uploads&#x2F;all&#x2F;documentation&#x2F;couchbase-api-misc.html#couchbase-api-
     * misc_uuids_get&quot;&gt;docs for &#x2F;_uuids&lt;&#x2F;a&gt;
     * @param {Int} cacheNum Number of uuids to keep cached for future use
     *&#x2F;
    newUUID: function(cacheNum) {
      if (cacheNum === undefined) {
        cacheNum = 1;
      }
      if (!uuidCache.length) {
        ajax({url: this.urlPrefix + &quot;&#x2F;_uuids&quot;, data: {count: cacheNum}, async:
              false}, {
            success: function(resp) {
              uuidCache = resp.uuids;
            }
          },
          &quot;Failed to retrieve UUID batch.&quot;
        );
      }
      return uuidCache.shift();
    }
  });

  &#x2F;**
   * @private
   *&#x2F;
  function ajax(obj, options, errorMessage, ajaxOptions) {

    var defaultAjaxOpts = {
      contentType: &quot;application&#x2F;json&quot;,
      headers:{&quot;Accept&quot;: &quot;application&#x2F;json&quot;}
    };

    options = $.extend({successStatus: 200}, options);
    ajaxOptions = $.extend(defaultAjaxOpts, ajaxOptions);
    errorMessage = errorMessage || &quot;Unknown error&quot;;
    $.ajax($.extend($.extend({
      type: &quot;GET&quot;, dataType: &quot;json&quot;, cache : !$.browser.msie,
      beforeSend: function(xhr){
        if(ajaxOptions &amp;&amp; ajaxOptions.headers){
          for (var header in ajaxOptions.headers){
            xhr.setRequestHeader(header, ajaxOptions.headers[header]);
          }
        }
      },
      complete: function(req) {
        try {
          var resp = $.parseJSON(req.responseText);
        } catch(e) {
          if (options.error) {
            options.error(req.status, req, e);
          } else {
            throw errorMessage + &#x27;: &#x27; + e;
          }
          return;
        }
        if (options.ajaxStart) {
          options.ajaxStart(resp);
        }
        if (req.status == options.successStatus) {
          if (options.beforeSuccess) options.beforeSuccess(req, resp);
          if (options.success) options.success(resp);
        } else if (options.error) {
          options.error(req.status, resp &amp;&amp; resp.error ||
                        errorMessage, resp &amp;&amp; resp.reason || &quot;no response&quot;);
        } else {
          throw errorMessage + &quot;: &quot; + resp.reason;
        }
      }
    }, obj), ajaxOptions));
  }

  &#x2F;**
   * @private
   *&#x2F;
  function fullCommit(options) {
    var options = options || {};
    if (typeof options.ensure_full_commit !== &quot;undefined&quot;) {
      var commit = options.ensure_full_commit;
      delete options.ensure_full_commit;
      return function(xhr) {
        xhr.setRequestHeader(&#x27;Accept&#x27;, &#x27;application&#x2F;json&#x27;);
        xhr.setRequestHeader(&quot;X-Couch-Full-Commit&quot;, commit.toString());
      };
    }
  };

  &#x2F;**
   * @private
   *&#x2F;
  &#x2F;&#x2F; Convert a options object to an url query string.
  &#x2F;&#x2F; ex: {key:&#x27;value&#x27;,key2:&#x27;value2&#x27;} becomes &#x27;?key=&quot;value&quot;&amp;key2=&quot;value2&quot;&#x27;
  function encodeOptions(options) {
    var buf = [];
    if (typeof(options) === &quot;object&quot; &amp;&amp; options !== null) {
      for (var name in options) {
        if ($.inArray(name,
                      [&quot;error&quot;, &quot;success&quot;, &quot;beforeSuccess&quot;, &quot;ajaxStart&quot;]) &gt;= 0)
          continue;
        var value = options[name];
        if ($.inArray(name, [&quot;key&quot;, &quot;startkey&quot;, &quot;endkey&quot;]) &gt;= 0) {
          value = toJSON(value);
        }
        buf.push(encodeURIComponent(name) + &quot;=&quot; + encodeURIComponent(value));
      }
    }
    return buf.length ? &quot;?&quot; + buf.join(&quot;&amp;&quot;) : &quot;&quot;;
  }

  &#x2F;**
   * @private
   *&#x2F;
  function toJSON(obj) {
    return obj !== null ? JSON.stringify(obj) : null;
  }

})(jQuery);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
